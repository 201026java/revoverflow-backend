<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>QuestionControllerTests.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">project-3-back-end (Jul 22, 2020 12:16:10 PM)</a> &gt; <a href="../../index.html" class="el_group">project-3-back-end</a> &gt; <a href="../index.html" class="el_bundle">src/test/java</a> &gt; <a href="index.source.html" class="el_package">com.revature.controllers</a> &gt; <span class="el_source">QuestionControllerTests.java</span></div><h1>QuestionControllerTests.java</h1><pre class="source lang-java linenums">package com.revature.controllers;

import static org.hamcrest.CoreMatchers.is;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotEquals;
import static org.junit.Assert.assertTrue;
import static org.mockito.Mockito.when;
import static org.springframework.security.test.web.servlet.setup.SecurityMockMvcConfigurers.springSecurity;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.http.MediaType;
import org.springframework.security.test.context.support.WithMockUser;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;
import org.springframework.web.context.WebApplicationContext;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.revature.Application;
import com.revature.controller.QuestionController;
import com.revature.entities.Question;
import com.revature.entities.User;
import com.revature.services.QuestionService;


@RunWith(SpringRunner.class)
@ContextConfiguration
@SpringBootTest(
		webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT,
		classes = Application.class)
@AutoConfigureMockMvc
<span class="fc" id="L56">public class QuestionControllerTests {</span>
	static User u1;
	
	@Autowired
	private MockMvc mvc;
	
	@Autowired
	private WebApplicationContext context;
	
	@MockBean
	private QuestionService questionService;
	
	@Autowired
    private ObjectMapper mapper;
	
    @Before                          
    public void setUp() {  
<span class="fc" id="L73">       u1 = new User(12,26,0,true,null,&quot;admin@rss.com&quot;,&quot;Admin&quot;,&quot;Admin&quot;);</span>
<span class="fc" id="L74">   	   mvc = MockMvcBuilders</span>
<span class="fc" id="L75">   				.webAppContextSetup(context)</span>
<span class="fc" id="L76">   				.apply(springSecurity())</span>
<span class="fc" id="L77">   				.build();</span>
<span class="fc" id="L78">    }</span>
    
	
	@Test
    @WithMockUser(username = &quot;user@rss.com&quot;, password = &quot;Password123!&quot;, authorities = &quot;user&quot;)
	public void testGetAllQuestionsHappyPath() throws Exception {
		
		// Create page of data
<span class="fc" id="L86">		List&lt;Question&gt; questions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L87">		questions.add(new Question(1,1,&quot;title&quot;,&quot;content&quot;, LocalDate.MIN, LocalDate.MIN, true, 1));</span>
<span class="fc" id="L88">		Page&lt;Question&gt; pageResult = new PageImpl&lt;&gt;(questions);</span>
		
		// Stub getAllQuestions to return page of data
<span class="fc" id="L91">		when(questionService.getAllQuestions(Mockito.any(Pageable.class))).thenReturn(pageResult);</span>
		
		// Call API end point and assert result
<span class="fc" id="L94">		mvc.perform(get(&quot;/questions&quot;)</span>
<span class="fc" id="L95">			.accept(MediaType.APPLICATION_JSON))</span>
<span class="fc" id="L96">			.andExpect(status().isOk())</span>
<span class="fc" id="L97">			.andExpect(content()</span>
<span class="fc" id="L98">					.contentTypeCompatibleWith(MediaType.APPLICATION_JSON))</span>
<span class="fc" id="L99">			.andExpect(jsonPath(&quot;$.content[0].title&quot;, is(&quot;title&quot;)));</span>
			
<span class="fc" id="L101">	}</span>
	
	/* @Author ken */
	@Test
    @WithMockUser(username = &quot;user@rss.com&quot;, password = &quot;Password123!&quot;, authorities = &quot;user&quot;)
	public void testGetAllQuestionsByUserId() throws Exception {
		// Create page of data
<span class="fc" id="L108">		List&lt;Question&gt; questions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L109">		questions.add(new Question(1,1,&quot;title&quot;,&quot;content&quot;, LocalDate.MIN, LocalDate.MIN, true, 1));</span>
<span class="fc" id="L110">		Page&lt;Question&gt; pageResult = new PageImpl&lt;&gt;(questions);</span>
		
		// Stub getAllQuestions to return page of data
<span class="fc" id="L113">		when(questionService.getAllQuestionsByUserId(Mockito.any(Pageable.class), Mockito.anyInt())).thenReturn(pageResult);</span>
		
		// Call API end point and assert result
<span class="fc" id="L116">		mvc.perform(get(&quot;/questions/user/1&quot;)</span>
<span class="fc" id="L117">			.accept(MediaType.APPLICATION_JSON))</span>
<span class="fc" id="L118">			.andExpect(status().isOk())</span>
<span class="fc" id="L119">			.andExpect(content()</span>
<span class="fc" id="L120">					.contentTypeCompatibleWith(MediaType.APPLICATION_JSON))</span>
<span class="fc" id="L121">			.andExpect(jsonPath(&quot;$.content[0].id&quot;, is(1)));</span>
			
<span class="fc" id="L123">	}</span>
	
	/* @Author ken 	*/
	@Test
    @WithMockUser(username = &quot;admin@rss.com&quot;, password = &quot;Password123!&quot;, authorities = &quot;admin&quot;)
	public void testGetAllQuestionsByStatus() throws Exception {
		
		// Create page of data
<span class="fc" id="L131">		List&lt;Question&gt; questions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L132">		questions.add(new Question(1,1,&quot;title&quot;, &quot;content&quot;, LocalDate.MIN, LocalDate.MIN, false, 1));</span>
<span class="fc" id="L133">		Page&lt;Question&gt; pageResult = new PageImpl&lt;&gt;(questions);</span>
		
		// Stub getAllQuestions to return page of data
<span class="fc" id="L136">		when(questionService.getAllQuestionsByStatus(Mockito.any(Pageable.class), Mockito.anyBoolean())).thenReturn(pageResult);</span>
		
		// Call API end point and assert result
<span class="fc" id="L139">		mvc.perform(get(&quot;/questions/status/false&quot;)</span>
<span class="fc" id="L140">			.accept(MediaType.APPLICATION_JSON))</span>
<span class="fc" id="L141">			.andExpect(status().isOk())</span>
<span class="fc" id="L142">			.andExpect(content()</span>
<span class="fc" id="L143">					.contentTypeCompatibleWith(MediaType.APPLICATION_JSON))</span>
<span class="fc" id="L144">			.andExpect(jsonPath(&quot;$.content[0].id&quot;, is(1)));</span>
			
<span class="fc" id="L146">	}</span>
	/**@author James */
	@Test
    @WithMockUser(username = &quot;admin@rss.com&quot;, password = &quot;Password123!&quot;, authorities = &quot;admin&quot;)
    public void updateStatus() throws Exception {
        Question questions, testQuestions;
<span class="fc" id="L152">        questions = new Question(1,1,&quot;title&quot;,&quot;content&quot;, LocalDate.MIN, LocalDate.MIN, false, 1);</span>
<span class="fc" id="L153">        testQuestions = new Question(1,1,&quot;title&quot;,&quot;content&quot;, LocalDate.MIN, LocalDate.MIN, true, 1);</span>
<span class="fc" id="L154">        when(questionService.updateQuestionStatus(Mockito.any(Question.class), Mockito.anyInt())).thenReturn(testQuestions);</span>
<span class="fc" id="L155">        String toUpdate = mapper.writeValueAsString(questions);</span>
<span class="fc" id="L156">        org.springframework.test.web.servlet.MvcResult result = mvc.perform(MockMvcRequestBuilders.put(&quot;/questions/status&quot;)</span>
<span class="fc" id="L157">                .contentType(MediaType.APPLICATION_JSON_UTF8)</span>
<span class="fc" id="L158">                .content(toUpdate)</span>
<span class="fc" id="L159">                .accept(MediaType.APPLICATION_JSON_UTF8)</span>
<span class="fc" id="L160">                ).andReturn();</span>
<span class="fc" id="L161">        String content = result.getResponse().getContentAsString();</span>
<span class="fc" id="L162">        assertEquals(200, result.getResponse().getStatus());</span>
       // assertTrue(&quot;This return object conains the string&quot;, content.contains(&quot;true&quot;));
       // assertNotEquals(null, content);
<span class="fc" id="L165">    }</span>
	/**@author James */
    @Test
    @WithMockUser(username = &quot;admin@rss.com&quot;, password = &quot;Password123!&quot;, authorities = &quot;user&quot;)
    public void updateQuestionAcceptedAnswerId() throws Exception {
        Question questions, testQuestions;
<span class="fc" id="L171">        questions = new Question(1,1,&quot;title&quot;,&quot;content&quot;, LocalDate.MIN, LocalDate.MIN, false, 1);</span>
<span class="fc" id="L172">        testQuestions = new Question(1,1,&quot;title&quot;,&quot;content&quot;, LocalDate.MIN, LocalDate.MIN, true, 1);</span>
<span class="fc" id="L173">        when(questionService.updateQuestionAcceptedAnswerId(Mockito.any(Question.class))).thenReturn(testQuestions);</span>
<span class="fc" id="L174">        String toUpdate = mapper.writeValueAsString(questions);</span>
<span class="fc" id="L175">        MvcResult result = mvc.perform(MockMvcRequestBuilders.put(&quot;/questions&quot;)</span>
<span class="fc" id="L176">                .contentType(MediaType.APPLICATION_JSON_UTF8)</span>
<span class="fc" id="L177">                .content(toUpdate)</span>
<span class="fc" id="L178">                .accept(MediaType.APPLICATION_JSON_UTF8)</span>
<span class="fc" id="L179">                ).andReturn();</span>
<span class="fc" id="L180">        String content = result.getResponse().getContentAsString();</span>
<span class="fc" id="L181">        assertEquals(200, result.getResponse().getStatus());</span>
<span class="fc" id="L182">        assertTrue(&quot;This return object conains the string&quot;, content.contains(&quot;true&quot;));</span>
<span class="fc" id="L183">        assertNotEquals(null, content);</span>
<span class="fc" id="L184">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span>project-3-back-end (Jul 22, 2020 12:16:10 PM)</div></body></html>